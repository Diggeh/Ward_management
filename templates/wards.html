<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Wards & Beds - Ward Management System</title>
      <style>
         * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
         font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
         }
         body {
         display: flex;
         min-height: 100vh;
         background: #f5f5f5;
         }
         .sidebar {
         width: 260px;
         background: #003344;
         color: white;
         padding: 24px;
         position: relative;
         min-height: 100vh;
         }
         .user-info {
         display: flex;
         align-items: center;
         gap: 12px;
         margin-bottom: 32px;
         }
         .user-info img {
         width: 32px;
         height: 32px;
         }
         .nav-links {
         display: flex;
         flex-direction: column;
         gap: 16px;
         }
         .nav-link {
         display: flex;
         align-items: center;
         gap: 12px;
         padding: 8px;
         text-decoration: none;
         color: white;
         border-radius: 4px;
         transition: background-color 0.2s;
         }
         .nav-link:hover {
         background: #004455;
         }
         .nav-link.active {
         background: #004455;
         }
         .nav-link img {
         width: 20px;
         height: 20px;
         }
         .logout {
         position: absolute;
         bottom: 24px;
         left: 24px;
         display: flex;
         align-items: center;
         gap: 12px;
         padding: 8px;
         background: none;
         border: none;
         color: white;
         cursor: pointer;
         border-radius: 4px;
         transition: background-color 0.2s;
         }
         .logout:hover {
         background: #004455;
         }
         .main-content {
         flex: 1;
         display: flex;
         flex-direction: column;
         }
         .header {
         background: #003344;
         color: white;
         padding: 24px;
         display: flex;
         justify-content: space-between;
         align-items: center;
         position: relative;
         padding-right: 160px;
         }
         .header h1 {
         font-size: 24px;
         font-weight: 600;
         }
         .back-button {
         position: absolute;
         right: 24px;
         top: 50%;
         transform: translateY(-50%);
         background: none;
         border: none;
         color: white;
         cursor: pointer;
         display: flex;
         align-items: center;
         gap: 8px;
         padding: 8px 16px;
         border-radius: 4px;
         transition: background-color 0.2s;
         margin: 0;
         }
         .back-button img {
         width: 16px;
         height: 16px;
         }
         .back-button:hover {
         background: #004455;
         }
         .search-section {
         padding: 24px;
         display: flex;
         flex-direction: column;
         align-items: center;
         gap: 16px;
         }
         .search-container {
         width: 100%;
         max-width: 800px;
         display: flex;
         gap: 12px;
         }
         .search-input {
         flex: 1;
         padding: 12px 20px;
         border: none;
         border-radius: 50px;
         background: #003344;
         color: white;
         font-size: 16px;
         }
         .search-input::placeholder {
         color: rgba(255, 255, 255, 0.6);
         }
         .search-input:focus {
         outline: 2px solid #0099cc;
         }
         .enter-button {
         padding: 12px 32px;
         background: #00cc99;
         color: white;
         border: none;
         border-radius: 4px;
         cursor: pointer;
         font-weight: 600;
         transition: background-color 0.2s;
         }
         .enter-button:hover {
         background: #00aa88;
         }
         .wards-container {
         margin: 0 24px;
         flex: 1;
         background: #003344;
         border-radius: 12px;
         padding: 24px;
         color: white;
         }
         .wards-grid {
         display: grid;
         grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
         gap: 20px;
         }
         .ward-card {
         background: #004455;
         border-radius: 8px;
         padding: 16px;
         cursor: pointer;
         transition: transform 0.2s;
         }
         .ward-card:hover {
         transform: translateY(-4px);
         }
         .ward-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 12px;
         }
         .ward-title {
         font-weight: 600;
         }
         .ward-type {
         font-size: 14px;
         opacity: 0.8;
         }
         .ward-content {
         font-size: 14px;
         line-height: 1.5;
         }
         /* Beds View Styles */
         .beds-view {
         display: none;
         padding: 24px;
         }
         .beds-view.active {
         display: block;
         }
         .wards-view {
         display: block;
         }
         .wards-view.hidden {
         display: none;
         }
         .beds-container {
         background: #003344;
         border-radius: 12px;
         padding: 24px;
         color: white;
         }
         .beds-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 24px;
         }
         .beds-header h2 {
         font-size: 20px;
         font-weight: 600;
         }
         .beds-grid {
         display: grid;
         grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
         gap: 16px;
         }
         .bed-card {
         background: #004455;
         border-radius: 8px;
         padding: 16px;
         cursor: pointer;
         transition: transform 0.2s;
         display: flex;
         flex-direction: column;
         align-items: center;
         text-align: center;
         }
         .bed-card:hover {
         transform: translateY(-4px);
         }
         .bed-number {
         font-size: 24px;
         font-weight: 600;
         margin-bottom: 8px;
         }
         .bed-status {
         padding: 4px 12px;
         border-radius: 20px;
         font-size: 14px;
         margin-bottom: 8px;
         }
         .bed-status.vacant {
         background: rgba(0, 204, 153, 0.2);
         color: #00cc99;
         }
         .bed-status.occupied {
         background: rgba(255, 102, 102, 0.2);
         color: #ff6666;
         }
         .bed-status.cleaning {
         background: rgba(255, 204, 0, 0.2);
         color: #ffcc00;
         }
         .bed-status.maintenance {
         background: rgba(153, 102, 255, 0.2);
         color: #9966ff;
         }
         /* Bed Detail View Styles */
         .bed-detail-view {
         display: none;
         padding: 24px;
         }
         .bed-detail-view.active {
         display: block;
         }
         .bed-detail-form {
         background: #003344;
         border-radius: 12px;
         padding: 24px;
         color: white;
         position: relative;
         padding-bottom: 80px;
         }
         .form-grid {
         display: grid;
         grid-template-columns: repeat(2, 1fr);
         gap: 20px;
         }
         .form-group {
         display: flex;
         flex-direction: column;
         gap: 8px;
         }
         .form-group.full-width {
         grid-column: 1 / -1;
         }
         .form-group label {
         font-size: 14px;
         font-weight: 500;
         }
         .form-group input,
         .form-group select {
         padding: 12px;
         background: #004455;
         border: none;
         border-radius: 4px;
         color: white;
         font-size: 14px;
         }
         .form-group input:focus,
         .form-group select:focus {
         outline: 2px solid #0099cc;
         }
         .update-button {
         position: absolute;
         bottom: 24px;
         right: 24px;
         padding: 12px 32px;
         background: #00cc99;
         color: white;
         border: none;
         border-radius: 4px;
         cursor: pointer;
         font-weight: 600;
         transition: background-color 0.2s;
         }
         .update-button:hover {
         background: #00aa88;
         }
         .status-message {
         position: absolute;
         bottom: 80px;
         left: 24px;
         right: 24px;
         padding: 12px;
         border-radius: 4px;
         text-align: center;
         display: none;
         }
         .status-message.success {
         background: rgba(0, 204, 153, 0.2);
         color: #00cc99;
         display: block;
         }
         .status-message.error {
         background: rgba(255, 0, 0, 0.2);
         color: #ff5555;
         display: block;
         }
         .no-wards,
         .no-beds {
         text-align: center;
         padding: 24px;
         color: rgba(255, 255, 255, 0.7);
         }
         .patient-info {
         margin-top: 16px;
         background: rgba(255, 255, 255, 0.1);
         border-radius: 4px;
         padding: 12px;
         }
         .patient-info h3 {
         font-size: 16px;
         margin-bottom: 8px;
         }
         .patient-info p {
         font-size: 14px;
         margin-bottom: 4px;
         }
         /* Ward Management Styles (for admin) */
         .admin-controls {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 16px;
         }
         .add-ward-button {
         padding: 8px 16px;
         background: #00cc99;
         color: white;
         border: none;
         border-radius: 4px;
         cursor: pointer;
         font-weight: 600;
         transition: background-color 0.2s;
         display: flex;
         align-items: center;
         gap: 8px;
         }
         .add-ward-button:hover {
         background: #00aa88;
         }
         .ward-management-view {
         display: none;
         padding: 24px;
         }
         .ward-management-view.active {
         display: block;
         }
         .ward-management-form {
         background: #003344;
         border-radius: 12px;
         padding: 24px;
         color: white;
         position: relative;
         padding-bottom: 80px;
         }
         .action-buttons {
         position: absolute;
         bottom: 24px;
         right: 24px;
         display: flex;
         gap: 12px;
         }
         .save-button,
         .delete-button {
         padding: 12px 32px;
         border: none;
         border-radius: 4px;
         cursor: pointer;
         font-weight: 600;
         transition: background-color 0.2s;
         }
         .save-button {
         background: #00cc99;
         color: white;
         }
         .save-button:hover {
         background: #00aa88;
         }
         .delete-button {
         background: #ff5555;
         color: white;
         }
         .delete-button:hover {
         background: #ff3333;
         }
         .beds-management {
         margin-top: 24px;
         }
         .beds-management h3 {
         margin-bottom: 16px;
         }
         .beds-table {
         width: 100%;
         border-collapse: collapse;
         margin-bottom: 16px;
         }
         .beds-table th,
         .beds-table td {
         padding: 12px;
         text-align: left;
         border-bottom: 1px solid rgba(255, 255, 255, 0.1);
         }
         .beds-table th {
         background: rgba(0, 0, 0, 0.2);
         }
         .add-bed-row {
         display: flex;
         gap: 12px;
         margin-bottom: 16px;
         }
         .add-bed-row input {
         flex: 1;
         padding: 8px 12px;
         background: #004455;
         border: none;
         border-radius: 4px;
         color: white;
         }
         .add-bed-button {
         padding: 8px 16px;
         background: #00cc99;
         color: white;
         border: none;
         border-radius: 4px;
         cursor: pointer;
         }
         @media (max-width: 768px) {
         .sidebar {
         width: 80px;
         padding: 16px;
         }
         .nav-link span,
         .user-info span,
         .logout span {
         display: none;
         }
         .header {
         padding-right: 24px;
         }
         .back-button {
         position: static;
         transform: none;
         margin-top: 16px;
         width: 100%;
         justify-content: center;
         }
         .search-container {
         flex-direction: column;
         }
         .search-input {
         border-radius: 4px;
         }
         .wards-container,
         .beds-container {
         margin: 16px;
         }
         .form-grid {
         grid-template-columns: 1fr;
         }
         .update-button,
         .action-buttons {
         position: static;
         width: 100%;
         margin-top: 20px;
         flex-direction: column;
         }
         .status-message {
         position: static;
         margin-bottom: 20px;
         }
         }
      </style>
   </head>
   <body>
      <div class="sidebar">
         <div class="user-info">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'/%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3C/svg%3E"
               alt="User">
            <span>{{ user.username }}</span>
         </div>
         <nav class="nav-links">
            <a href="{{ url_for('main.dashboard') }}" class="nav-link">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='7' height='7'/%3E%3Crect x='14' y='3' width='7' height='7'/%3E%3Crect x='14' y='14' width='7' height='7'/%3E%3Crect x='3' y='14' width='7' height='7'/%3E%3C/svg%3E"
               alt="Dashboard">
            <span>Dashboard</span>
            </a>
            <a href="{{ url_for('main.wards') }}" class="nav-link active">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z'/%3E%3Cpolyline points='9 22 9 12 15 12 15 22'/%3E%3C/svg%3E"
               alt="Wards">
            <span>Wards </span>
            </a>
            <a href="{{ url_for('main.patients') }}" class="nav-link">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2'/%3E%3Ccircle cx='9' cy='7' r='4'/%3E%3Cpath d='M23 21v-2a4 4 0 0 0-3-3.87'/%3E%3Cpath d='M16 3.13a4 4 0 0 1 0 7.75'/%3E%3C/svg%3E"
               alt="Patients">
            <span>Patients</span>
            </a>
            <a href="{{ url_for('main.admission') }}" class="nav-link">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2'/%3E%3Ccircle cx='8.5' cy='7' r='4'/%3E%3Cline x1='20' y1='8' x2='20' y2='14'/%3E%3Cline x1='23' y1='11' x2='17' y2='11'/%3E%3C/svg%3E"
               alt="Admission">
            <span>Admission</span>
            </a>
            <a href="{{ url_for('main.medical_records') }}" class="nav-link">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'/%3E%3Cpolyline points='14 2 14 8 20 8'/%3E%3Cline x1='16' y1='13' x2='8' y2='13'/%3E%3Cline x1='16' y1='17' x2='8' y2='17'/%3E%3Cpolyline points='10 9 9 9 8 9'/%3E%3C/svg%3E"
               alt="Medical Records">
            <span>Medical Records</span>
            </a>
            {# Show Admin link only if user is an admin (role_id = 1) #}
            {% if user.role_id == 1 %}
            <a href="{{ url_for('main.admin_page') }}"
               class="nav-link {% if request.endpoint == 'main.admin_page' %}active{% endif %}">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='3'/%3E%3Cpath d='M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z'/%3E%3C/svg%3E"
               alt="Admin">
            <span>Admin</span>
            </a>
            {% endif %}
         </nav>
         <form action="{{ url_for('auth.logout') }}" method="POST" style="display: inline;">
            <button type="submit" class="logout">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4'/%3E%3Cpolyline points='16 17 21 12 16 7'/%3E%3Cline x1='21' y1='12' x2='9' y2='12'/%3E%3C/svg%3E"
               alt="Logout">
            <span>Log Out</span>
            </button>
         </form>
      </div>
      <div class="main-content">
         <header class="header">
            <h1>WARDS & BEDS</h1>
            <button id="back-to-wards-button" class="back-button" style="display: none;">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='19' y1='12' x2='5' y2='12'/%3E%3Cpolyline points='12 19 5 12 12 5'/%3E%3C/svg%3E"
               alt="Back">
            Back to Wards
            </button>
            <button id="back-to-beds-button" class="back-button" style="display: none;">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='19' y1='12' x2='5' y2='12'/%3E%3Cpolyline points='12 19 5 12 12 5'/%3E%3C/svg%3E"
               alt="Back">
            Back to Beds
            </button>
         </header>
         <!-- Wards View -->
         <div class="wards-view">
            <div class="search-section">
               <div class="search-container">
                  <input type="text" id="ward-search-input" class="search-input"
                     placeholder="Search for ward name...">
               </div>
               <button id="ward-search-button" class="enter-button">SEARCH</button>
               <!-- Admin controls - only visible to admins -->
               {% if user.role_id == 1 %}
               <div class="admin-controls">
                  <button id="add-ward-button" class="add-ward-button">
                  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='12' y1='5' x2='12' y2='19'/%3E%3Cline x1='5' y1='12' x2='19' y2='12'/%3E%3C/svg%3E"
                     width="16" height="16" alt="Add">
                  Add New Ward
                  </button>
               </div>
               {% endif %}
            </div>
            <div class="wards-container">
               <div id="wards-grid" class="wards-grid">
                  <!-- Wards will be loaded here dynamically -->
               </div>
            </div>
         </div>
         <!-- Beds View -->
         <div class="beds-view" style="display: none;">
            <div class="beds-container">
               <div class="beds-header">
                  <h2 id="ward-name">Ward Name</h2>
                  <span id="ward-capacity">Capacity: 0/0</span>
               </div>
               <div id="beds-grid" class="beds-grid">
                  <!-- Beds will be loaded here dynamically -->
               </div>
            </div>
         </div>
         <!-- Bed Detail View -->
         <div class="bed-detail-view" style="display: none;">
            <div class="bed-detail-form">
               <div class="form-grid">
                  <div class="form-group">
                     <label for="bed-number">Bed Number:</label>
                     <input type="text" id="bed-number" readonly>
                     <input type="hidden" id="bed-id">
                     <input type="hidden" id="ward-id">
                  </div>
                  <div class="form-group">
                     <label for="bed-status">Bed Status:</label>
                     <select id="bed-status">
                        <option value="Vacant">Vacant</option>
                        <option value="Occupied">Occupied</option>
                        <option value="Cleaning">Cleaning</option>
                        <option value="Maintenance">Maintenance</option>
                     </select>
                  </div>
                  <div id="patient-info-container" class="form-group full-width" style="display: none;">
                     <div class="patient-info">
                        <h3>Current Patient</h3>
                        <p id="patient-name">Name: </p>
                        <p id="admission-date">Admitted: </p>
                        <p id="doctor">Doctor: </p>
                        <p id="diagnosis">Diagnosis: </p>
                     </div>
                  </div>
               </div>
               <button id="update-bed-button" class="update-button">UPDATE</button>
               <div id="status-message" class="status-message"></div>
            </div>
         </div>
         <!-- Ward Management View (for admin) -->
         {% if user.role_id == 1 %}
         <div class="ward-management-view" style="display: none;">
            <div class="ward-management-form">
               <div class="form-grid">
                  <div class="form-group">
                     <label for="ward-name-input">Ward Name:</label>
                     <input type="text" id="ward-name-input" required>
                     <input type="hidden" id="ward-id-input">
                  </div>
                  <div class="form-group">
                     <label for="ward-type">Ward Type:</label>
                     <select id="ward-type">
                        <option value="General">General</option>
                        <option value="Emergency">Emergency</option>
                        <option value="Intensive Care Unit">Intensive Care Unit</option>
                        <option value="Intensive Coronary Care Unit">Intensive Coronary Care Unit</option>
                        <option value="Nursery">Nursery</option>
                        <option value="Special Septic Nursery">Special Septic Nursery</option>
                        <option value="Postoperative">Postoperative</option>
                        <option value="Burn">Burn</option>
                        <option value="Postnatal">Postnatal</option>
                        <option value="Protective Isolation">Protective Isolation</option>
                        <option value="Infectious Disease">Infectious Disease</option>
                     </select>
                  </div>
                  <div class="form-group">
                     <label for="ward-capacity">Ward Capacity:</label>
                     <input type="number" id="ward-capacity-input" min="1" required>
                  </div>
               </div>
               <!-- Beds Management Section -->
               <div class="beds-management" id="beds-management-section" style="display: none;">
                  <h3>Manage Beds</h3>
                  <table class="beds-table" id="beds-table">
                     <thead>
                        <tr>
                           <th>Bed Number</th>
                           <th>Status</th>
                           <th>Actions</th>
                        </tr>
                     </thead>
                     <tbody id="beds-table-body">
                        <!-- Beds will be loaded here -->
                     </tbody>
                  </table>
                  <div class="add-bed-row">
                     <input type="number" id="new-bed-number" placeholder="Bed Number" min="1">
                     <select id="new-bed-status">
                        <option value="Vacant">Vacant</option>
                        <option value="Cleaning">Cleaning</option>
                        <option value="Maintenance">Maintenance</option>
                     </select>
                     <button id="add-bed-button" class="add-bed-button">Add Bed</button>
                  </div>
               </div>
               <div id="ward-status-message" class="status-message"></div>
               <div class="action-buttons">
                  <button id="save-ward-button" class="save-button">SAVE WARD</button>
                  <button id="delete-ward-button" class="delete-button" style="display: none;">DELETE WARD</button>
               </div>
            </div>
         </div>
         {% endif %}
      </div>
      <script>
         // Define user permissions for JavaScript use
         window.userPermissions = {
         canViewWards: {{ check_permission('view_patients')|tojson }},
         canManageWards: {{ check_permission('manage_wards')|tojson }},
         // Only nurses (role_id = 3) and admins (role_id = 1) can update bed status
         canUpdateBedStatus: {{ (current_user.role_id == 3 or current_user.role_id == 1)|tojson }}
         };
         
         // Load all wards when the page loads
         document.addEventListener('DOMContentLoaded', function () {
         // Check if user has permission to view wards
         if (!window.userPermissions.canViewWards) {
         document.querySelector('.main-content').innerHTML = 
             '<div style="text-align: center; padding: 30px; color: white; background: #003344; margin: 24px; border-radius: 12px;">' +
             '<h3>You do not have permission to view wards and beds.</h3>' +
             '</div>';
         return;
         }
         
         loadWards();
         
         // Add event listeners
         document.querySelector('#ward-search-button').addEventListener('click', searchWards);
         document.querySelector('#ward-search-input').addEventListener('keypress', function (e) {
         if (e.key === 'Enter') {
             searchWards();
         }
         });
         
         document.querySelector('#back-to-wards-button').addEventListener('click', showWardsView);
         document.querySelector('#back-to-beds-button').addEventListener('click', function () {
         showBedsView(currentWardId, currentWardName, currentWardCapacity);
         });
         
         // Only add update button event listener if user is a nurse or admin
         if (window.userPermissions.canUpdateBedStatus) {
         document.querySelector('#update-bed-button').addEventListener('click', updateBed);
         } else {
         // Hide update button if user is not a nurse or admin
         document.querySelector('#update-bed-button').style.display = 'none';
         }
         
         // Admin functionality
         {% if user.role_id == 1 or check_permission('manage_wards') %}
         document.querySelector('#add-ward-button').addEventListener('click', showAddWardForm);
         document.querySelector('#save-ward-button').addEventListener('click', saveWard);
         document.querySelector('#delete-ward-button').addEventListener('click', deleteWard);
         document.querySelector('#add-bed-button').addEventListener('click', addBed);
         {% endif %}
         });
         
         // Global variables to store current ward and bed information
         let currentWardId = null;
         let currentWardName = null;
         let currentWardCapacity = null;
         
         // Function to load all wards
         function loadWards() {
         fetch('/get-wards')
         .then(response => response.json())
         .then(data => {
             displayWards(data);
         })
         .catch(error => {
             console.error('Error loading wards:', error);
         });
         }
         
         // Function to search wards
         function searchWards() {
         const searchTerm = document.querySelector('#ward-search-input').value;
         
         fetch(`/search-wards?query=${encodeURIComponent(searchTerm)}`)
         .then(response => response.json())
         .then(data => {
             displayWards(data);
         })
         .catch(error => {
             console.error('Error searching wards:', error);
         });
         }
         
         // Function to display wards in the grid
         function displayWards(wards) {
         const wardsGrid = document.querySelector('#wards-grid');
         wardsGrid.innerHTML = '';
         
         if (wards.length === 0) {
         wardsGrid.innerHTML = '<div class="no-wards">No wards found</div>';
         return;
         }
         
         wards.forEach(ward => {
         const wardCard = document.createElement('div');
         wardCard.className = 'ward-card';
         wardCard.setAttribute('data-ward-id', ward.ward_id);
         
         // Use total_beds instead of ward_capacity
         wardCard.innerHTML = `
             <div class="ward-header">
                 <span class="ward-title">${ward.ward_name}</span>
                 <span class="ward-type">${ward.ward_type}</span>
             </div>
             <div class="ward-content">
                 <p>Capacity: ${ward.occupied_beds}/${ward.total_beds}</p>
                 <p>Available Beds: ${ward.vacant_beds}</p>
             </div>
         `;
         
         wardCard.addEventListener('click', function (e) {
             const wardId = this.getAttribute('data-ward-id');
         
             {% if user.role_id == 1 or check_permission('manage_wards') %}
             // If admin or manager clicked with Ctrl/Cmd key, show edit form instead
             if (e.ctrlKey || e.metaKey) {
                 showEditWardForm(wardId);
                 return;
             }
             {% endif %}
         
             // Otherwise show beds view
             showBedsView(wardId, ward.ward_name, ward.total_beds);
         });
         
         wardsGrid.appendChild(wardCard);
         });
         
         {% if user.role_id == 1 or check_permission('manage_wards') %}
         // Add note for admins about Ctrl+click
         const adminNote = document.createElement('div');
         adminNote.style.textAlign = 'center';
         adminNote.style.marginTop = '20px';
         adminNote.style.color = 'rgba(255, 255, 255, 0.7)';
         adminNote.textContent = 'Hold ctrl while clicking on a ward to edit its information.';
         wardsGrid.appendChild(adminNote);
         {% endif %}
         }
         
         // Function to show beds view for a specific ward
         function showBedsView(wardId, wardName, totalBeds) {
         // Save current ward info
         currentWardId = wardId;
         currentWardName = wardName;
         currentWardCapacity = totalBeds; // Now storing total beds instead of capacity
         
         // Update the UI
         document.querySelector('#ward-name').textContent = wardName;
         
         // Load beds for this ward
         fetch(`/get-ward-beds/${wardId}`)
         .then(response => response.json())
         .then(data => {
             // Calculate occupied beds from the data
             const occupiedBeds = data.filter(bed => bed.bed_status === 'Occupied').length;
         
             // Update capacity display with actual counts
             document.querySelector('#ward-capacity').textContent = `Capacity: ${occupiedBeds}/${data.length}`;
         
             displayBeds(data);
         
             // Show beds view, hide other views
             document.querySelector('.wards-view').style.display = 'none';
             document.querySelector('.beds-view').style.display = 'block';
             document.querySelector('.bed-detail-view').style.display = 'none';
         
             {% if user.role_id == 1 or check_permission('manage_wards') %}
             document.querySelector('.ward-management-view').style.display = 'none';
             {% endif %}
         
             document.querySelector('#back-to-wards-button').style.display = 'flex';
             document.querySelector('#back-to-beds-button').style.display = 'none';
         })
         .catch(error => {
             console.error('Error loading beds:', error);
         });
         }
         
         // Function to display beds in the grid
         function displayBeds(beds) {
         const bedsGrid = document.querySelector('#beds-grid');
         bedsGrid.innerHTML = '';
         
         if (beds.length === 0) {
         bedsGrid.innerHTML = '<div class="no-beds">No beds found for this ward</div>';
         return;
         }
         
         beds.forEach(bed => {
         const bedCard = document.createElement('div');
         bedCard.className = 'bed-card';
         bedCard.setAttribute('data-bed-id', bed.bed_id);
         
         let statusClass = '';
         switch (bed.bed_status.toLowerCase()) {
             case 'vacant':
                 statusClass = 'vacant';
                 break;
             case 'occupied':
                 statusClass = 'occupied';
                 break;
             case 'cleaning':
                 statusClass = 'cleaning';
                 break;
             case 'maintenance':
                 statusClass = 'maintenance';
                 break;
             default:
                 statusClass = '';
         }
         
         bedCard.innerHTML = `
             <div class="bed-number">Bed ${bed.bed_number}</div>
             <div class="bed-status ${statusClass}">${bed.bed_status}</div>
             ${bed.patient_name ? `<p>Patient: ${bed.patient_name}</p>` : ''}
         `;
         
         bedCard.addEventListener('click', function () {
             const bedId = this.getAttribute('data-bed-id');
             showBedDetailView(bedId);
         });
         
         bedsGrid.appendChild(bedCard);
         });
         }
         
         // Function to show bed detail view
         function showBedDetailView(bedId) {
         fetch(`/get-bed/${bedId}`)
         .then(response => response.json())
         .then(data => {
             // Populate the form fields
             document.querySelector('#bed-id').value = data.bed_id;
             document.querySelector('#ward-id').value = data.ward_id;
             document.querySelector('#bed-number').value = data.bed_number;
             document.querySelector('#bed-status').value = data.bed_status;
         
             // Store original status for comparison
             document.querySelector('#bed-status').setAttribute('data-original-status', data.bed_status);
         
             // Make bed status dropdown readonly if user doesn't have permission
             if (!window.userPermissions.canUpdateBedStatus) {
                 document.querySelector('#bed-status').disabled = true;
             } else {
                 document.querySelector('#bed-status').disabled = false;
             }
         
             // Show/hide patient info based on bed status
             const patientInfoContainer = document.querySelector('#patient-info-container');
             if (data.bed_status === 'Occupied' && data.patient_info) {
                 patientInfoContainer.style.display = 'block';
                 document.querySelector('#patient-name').textContent = `Name: ${data.patient_info.name}`;
                 document.querySelector('#admission-date').textContent = `Admitted: ${data.patient_info.admission_date}`;
                 document.querySelector('#doctor').textContent = `Doctor: ${data.patient_info.doctor}`;
                 document.querySelector('#diagnosis').textContent = `Diagnosis: ${data.patient_info.diagnosis || 'None'}`;
             } else {
                 patientInfoContainer.style.display = 'none';
             }
         
             // Show the detail view
             document.querySelector('.beds-view').style.display = 'none';
             document.querySelector('.bed-detail-view').style.display = 'block';
         
             {% if user.role_id == 1 or check_permission('manage_wards') %}
             document.querySelector('.ward-management-view').style.display = 'none';
             {% endif %}
         
             document.querySelector('#back-to-wards-button').style.display = 'none';
             document.querySelector('#back-to-beds-button').style.display = 'flex';
         
             // Clear any previous status messages
             const statusMessage = document.querySelector('#status-message');
             statusMessage.textContent = '';
             statusMessage.className = 'status-message';
         })
         .catch(error => {
             console.error('Error loading bed details:', error);
         });
         }
         
         // Function to show the wards view
         function showWardsView() {
         document.querySelector('.wards-view').style.display = 'block';
         document.querySelector('.beds-view').style.display = 'none';
         document.querySelector('.bed-detail-view').style.display = 'none';
         
         {% if user.role_id == 1 or check_permission('manage_wards') %}
         document.querySelector('.ward-management-view').style.display = 'none';
         {% endif %}
         
         document.querySelector('#back-to-wards-button').style.display = 'none';
         document.querySelector('#back-to-beds-button').style.display = 'none';
         
         // Refresh wards data
         loadWards();
         }
         
         // Function to update a bed
         function updateBed() {
         // Check if user has permission
         if (!window.userPermissions.canUpdateBedStatus) {
         const statusMessage = document.querySelector('#status-message');
         statusMessage.textContent = 'You do not have permission to update bed status.';
         statusMessage.className = 'status-message error';
         return;
         }
         
         const bedId = document.querySelector('#bed-id').value;
         const previousStatus = document.querySelector('#bed-status').getAttribute('data-original-status');
         const newStatus = document.querySelector('#bed-status').value;
         
         // Check if trying to change status from Occupied to something else
         if (previousStatus === 'Occupied' && newStatus !== 'Occupied') {
         if (!confirm('This bed is currently occupied. Changing its status will discharge the patient. Continue?')) {
             return;
         }
         }
         
         const data = {
         bed_status: newStatus
         };
         
         fetch(`/update-bed/${bedId}`, {
         method: 'POST',
         headers: {
             'Content-Type': 'application/json',
         },
         body: JSON.stringify(data)
         })
         .then(response => response.json())
         .then(data => {
             const statusMessage = document.querySelector('#status-message');
         
             if (data.success) {
                 statusMessage.textContent = data.message;
                 statusMessage.className = 'status-message success';
         
                 // Update original status attribute
                 document.querySelector('#bed-status').setAttribute('data-original-status', newStatus);
         
                 // If status changed from/to Occupied, refresh patient info
                 if (previousStatus === 'Occupied' || newStatus === 'Occupied') {
                     showBedDetailView(bedId);
                 }
             } else {
                 statusMessage.textContent = data.error;
                 statusMessage.className = 'status-message error';
             }
         })
         .catch(error => {
             console.error('Error updating bed:', error);
             const statusMessage = document.querySelector('#status-message');
             statusMessage.textContent = 'An error occurred while updating the bed.';
             statusMessage.className = 'status-message error';
         });
         }
         
         {% if user.role_id == 1 or check_permission('manage_wards') %}
         // ADMIN FUNCTIONS
         
         // Function to show form for adding a new ward
         function showAddWardForm() {
         // Clear the form
         document.querySelector('#ward-id-input').value = '';
         document.querySelector('#ward-name-input').value = '';
         document.querySelector('#ward-type').value = 'General';
         document.querySelector('#ward-capacity-input').value = '';
         
         // Hide beds management section for new wards
         document.querySelector('#beds-management-section').style.display = 'none';
         
         // Hide delete button for new wards
         document.querySelector('#delete-ward-button').style.display = 'none';
         
         // Show the ward management view
         document.querySelector('.wards-view').style.display = 'none';
         document.querySelector('.beds-view').style.display = 'none';
         document.querySelector('.bed-detail-view').style.display = 'none';
         document.querySelector('.ward-management-view').style.display = 'block';
         
         // Clear status message
         const statusMessage = document.querySelector('#ward-status-message');
         statusMessage.textContent = '';
         statusMessage.className = 'status-message';
         }
         
         // Function to show form for editing an existing ward
         function showEditWardForm(wardId) {
         fetch(`/get-ward/${wardId}`)
         .then(response => response.json())
         .then(data => {
             // Populate the form fields
             document.querySelector('#ward-id-input').value = data.ward_id;
             document.querySelector('#ward-name-input').value = data.ward_name;
             document.querySelector('#ward-type').value = data.ward_type;
             document.querySelector('#ward-capacity-input').value = data.ward_capacity;
         
             // Load beds for this ward
             loadBedsForManagement(wardId);
         
             // Show beds management section for existing wards
             document.querySelector('#beds-management-section').style.display = 'block';
         
             // Show delete button for existing wards
             document.querySelector('#delete-ward-button').style.display = 'inline-block';
         
             // Show the ward management view
             document.querySelector('.wards-view').style.display = 'none';
             document.querySelector('.beds-view').style.display = 'none';
             document.querySelector('.bed-detail-view').style.display = 'none';
             document.querySelector('.ward-management-view').style.display = 'block';
         
             // Show the back button
             document.querySelector('#back-to-wards-button').style.display = 'flex';
             document.querySelector('#back-to-beds-button').style.display = 'none';
         
             // Clear status message
             const statusMessage = document.querySelector('#ward-status-message');
             statusMessage.textContent = '';
             statusMessage.className = 'status-message';
         })
         .catch(error => {
             console.error('Error loading ward details:', error);
         });
         }
         
         
         // Function to load beds for management
         function loadBedsForManagement(wardId) {
         fetch(`/get-ward-beds/${wardId}`)
         .then(response => response.json())
         .then(data => {
             const bedsTableBody = document.querySelector('#beds-table-body');
             bedsTableBody.innerHTML = '';
         
             data.forEach(bed => {
                 const row = document.createElement('tr');
         
                 row.innerHTML = `
                     <td>Bed ${bed.bed_number}</td>
                     <td>${bed.bed_status}</td>
                     <td>
                         <button class="delete-bed-button" data-bed-id="${bed.bed_id}" 
                             ${bed.bed_status === 'Occupied' ? 'disabled' : ''}>
                             Delete
                         </button>
                     </td>
                 `;
         
                 bedsTableBody.appendChild(row);
             });
         
             // Add event listeners to delete buttons
             document.querySelectorAll('.delete-bed-button').forEach(button => {
                 if (!button.disabled) {
                     button.addEventListener('click', function () {
                         const bedId = this.getAttribute('data-bed-id');
                         deleteBed(bedId);
                     });
                 }
             });
         })
         .catch(error => {
             console.error('Error loading beds for management:', error);
         });
         }
         
         // Function to save a ward (create or update)
         function saveWard() {
         const wardId = document.querySelector('#ward-id-input').value;
         const wardName = document.querySelector('#ward-name-input').value;
         const wardType = document.querySelector('#ward-type').value;
         const wardCapacity = document.querySelector('#ward-capacity-input').value;
         
         if (!wardName || !wardCapacity) {
         const statusMessage = document.querySelector('#ward-status-message');
         statusMessage.textContent = 'Please fill out all required fields';
         statusMessage.className = 'status-message error';
         return;
         }
         
         const data = {
         ward_name: wardName,
         ward_type: wardType,
         ward_capacity: parseInt(wardCapacity)
         };
         
         let url = '/create-ward';
         let method = 'POST';
         
         if (wardId) {
         url = `/update-ward/${wardId}`;
         method = 'POST';
         }
         
         fetch(url, {
         method: method,
         headers: {
             'Content-Type': 'application/json',
         },
         body: JSON.stringify(data)
         })
         .then(response => response.json())
         .then(data => {
             const statusMessage = document.querySelector('#ward-status-message');
         
             if (data.success) {
                 statusMessage.textContent = data.message;
                 statusMessage.className = 'status-message success';
         
                 // If creating a new ward, update the form to edit mode
                 if (!wardId && data.ward_id) {
                     document.querySelector('#ward-id-input').value = data.ward_id;
                     document.querySelector('#delete-ward-button').style.display = 'inline-block';
                     document.querySelector('#beds-management-section').style.display = 'block';
                     loadBedsForManagement(data.ward_id);
                 }
             } else {
                 statusMessage.textContent = data.error;
                 statusMessage.className = 'status-message error';
             }
         })
         .catch(error => {
             console.error('Error saving ward:', error);
             const statusMessage = document.querySelector('#ward-status-message');
             statusMessage.textContent = 'An error occurred while saving the ward.';
             statusMessage.className = 'status-message error';
         });
         }
         
         // Function to delete a ward
         function deleteWard() {
         const wardId = document.querySelector('#ward-id-input').value;
         
         if (!wardId) {
         return;
         }
         
         if (!confirm('Are you sure you want to delete this ward? This will also delete all associated beds.')) {
         return;
         }
         
         fetch(`/delete-ward/${wardId}`, {
         method: 'POST'
         })
         .then(response => response.json())
         .then(data => {
             if (data.success) {
                 // Return to wards view
                 showWardsView();
             } else {
                 const statusMessage = document.querySelector('#ward-status-message');
                 statusMessage.textContent = data.error;
                 statusMessage.className = 'status-message error';
             }
         })
         .catch(error => {
             console.error('Error deleting ward:', error);
             const statusMessage = document.querySelector('#ward-status-message');
             statusMessage.textContent = 'An error occurred while deleting the ward.';
             statusMessage.className = 'status-message error';
         });
         }
         
         // Function to add a new bed
         function addBed() {
         const wardId = document.querySelector('#ward-id-input').value;
         const bedNumber = document.querySelector('#new-bed-number').value;
         const bedStatus = document.querySelector('#new-bed-status').value;
         
         if (!wardId || !bedNumber) {
         const statusMessage = document.querySelector('#ward-status-message');
         statusMessage.textContent = 'Please enter a bed number';
         statusMessage.className = 'status-message error';
         return;
         }
         
         const data = {
         ward_id: wardId,
         bed_number: parseInt(bedNumber),
         bed_status: bedStatus
         };
         
         fetch('/create-bed', {
         method: 'POST',
         headers: {
             'Content-Type': 'application/json',
         },
         body: JSON.stringify(data)
         })
         .then(response => response.json())
         .then(data => {
             const statusMessage = document.querySelector('#ward-status-message');
         
             if (data.success) {
                 statusMessage.textContent = data.message;
                 statusMessage.className = 'status-message success';
         
                 // Clear bed number input
                 document.querySelector('#new-bed-number').value = '';
         
                 // Refresh beds table
                 loadBedsForManagement(wardId);
             } else {
                 statusMessage.textContent = data.error;
                 statusMessage.className = 'status-message error';
             }
         })
         .catch(error => {
             console.error('Error adding bed:', error);
             const statusMessage = document.querySelector('#ward-status-message');
             statusMessage.textContent = 'An error occurred while adding the bed.';
             statusMessage.className = 'status-message error';
         });
         }
         
         // Function to delete a bed
         function deleteBed(bedId) {
         if (!confirm('Are you sure you want to delete this bed?')) {
         return;
         }
         
         fetch(`/delete-bed/${bedId}`, {
         method: 'POST'
         })
         .then(response => response.json())
         .then(data => {
             const statusMessage = document.querySelector('#ward-status-message');
         
             if (data.success) {
                 statusMessage.textContent = data.message;
                 statusMessage.className = 'status-message success';
         
                 // Refresh beds table
                 const wardId = document.querySelector('#ward-id-input').value;
                 loadBedsForManagement(wardId);
             } else {
                 statusMessage.textContent = data.error;
                 statusMessage.className = 'status-message error';
             }
         })
         .catch(error => {
             console.error('Error deleting bed:', error);
             const statusMessage = document.querySelector('#ward-status-message');
             statusMessage.textContent = 'An error occurred while deleting the bed.';
             statusMessage.className = 'status-message error';
         });
         }
         {% endif %}
      </script>
   </body>
</html>
